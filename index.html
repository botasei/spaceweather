<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Space Weather Forecast - Institute of Ionosphere</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
  /* ---------- БАЗОВОЕ ---------- */
  html,body{
    margin:0;
    padding:0;
    font-family: Arial, sans-serif;
    color:white;
    background:#000;
    height:100%;
  }
  .page-wrapper{
    min-height:100vh;
    display:flex;
    flex-direction:column;
    background: url('background.jpg') center/cover no-repeat fixed;
  }
  .overlay{
    background: rgba(0,0,0,0.75);
    flex:1;
  }
  .container{
    max-width:1500px;
    margin:0 auto;
    padding:20px;
  }

  /* ---------- ШАПКА ---------- */
  .header{
    width:100%;
    padding:24px 20px 10px;
    box-sizing:border-box;
  }
  .logo-group{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:20px;
  }
  .logo-group img{
    width:140px;
    height:auto;
    object-fit:contain;
    filter: drop-shadow(0 0 8px rgba(0,0,0,0.65));
  }
  .header-title{
    text-align:center;
    flex:1;
    padding:0 10px;
  }
  .header-title h1{
    margin:0;
    font-size:44px;
    font-weight:800;
    letter-spacing:0.5px;
    text-shadow: 0 2px 8px rgba(0,0,0,0.55);
  }
  .header-title p{
    margin:10px 0 0;
    font-size:20px;
    line-height:1.25;
    font-weight:600;
    text-shadow: 0 2px 8px rgba(0,0,0,0.55);
  }

  /* ---------- СЕТКА ---------- */
  .content-row{
    display:flex;
    gap:20px;
    margin-top:16px;
    align-items:stretch;
  }
  .panel-wide{
    flex: 3;
    min-width:0;
  }
  .right-column{
    flex: 1.6;
    min-width:320px;
    display:flex;
    flex-direction:column;
    gap:20px;
  }

  /* ---------- ПАНЕЛИ ---------- */
  .panel{
    background: rgba(0,0,0,0.70);
    border:1px solid rgba(255,255,255,0.12);
    border-radius:14px;
    padding:18px;
    box-shadow:0 8px 20px rgba(0,0,0,0.35);
  }
  .panel h2{
    margin:0 0 10px;
    font-size:26px;
    font-weight:800;
    letter-spacing:0.3px;
  }
  .panel p{
    margin:0;
    font-size:18px;
    line-height:1.5;
    color:#e8e8e8;
  }

  /* верхний большой график */
  .chart-area{
    margin-top:14px;
    border-radius:14px;
    overflow:hidden;
    border:1px solid rgba(255,255,255,0.12);
    background: rgba(0,0,0,0.55);
    padding:8px;
  }

  /* ---------- АДМИН ---------- */
  .admin-panel{
    display:none;
    margin-top:14px;
    background: rgba(20,20,20,0.85);
    border:1px solid rgba(255,255,255,0.16);
    border-radius:12px;
    padding:14px;
  }
  .admin-panel h3{
    margin:0 0 10px;
    font-size:20px;
  }
  .form-grid{
    display:grid;
    grid-template-columns: 1fr 1fr;
    gap:12px;
  }
  .form-grid label{
    font-size:14px;
    color:#ddd;
    display:block;
    margin-bottom:4px;
  }
  .form-grid input{
    width:100%;
    padding:8px 10px;
    border-radius:8px;
    border:1px solid rgba(255,255,255,0.2);
    background:#111;
    color:#fff;
    box-sizing:border-box;
  }
  .form-actions{
    margin-top:12px;
    display:flex;
    gap:10px;
  }
  .btn{
    border:none;
    border-radius:10px;
    padding:10px 14px;
    cursor:pointer;
    font-weight:700;
    font-size:14px;
  }
  .btn-save{ background:#2ecc71; color:#000; }
  .btn-reset{ background:#f1c40f; color:#000; }
  .btn-admin{
    margin-top:10px;
    background:#3498db;
    color:#fff;
  }

  /* ---------- НИЖНИЙ БЛОК (состояние + alma chart) ---------- */
  .bottom-block{
    margin-top:20px;
  }
  .panel-bottom h2{
    font-size:24px;
  }

  /* ---------- ГРАФИКИ ---------- */
  #kpChart{
    width:100%;
    height:580px !important;
    background-color:transparent;
  }

  /* alma chart wrapper */
  .chart-wrap{ position:relative; width:100%; }
  .chart-wrap-alma{ height:420px; }
  .chart-wrap-alma canvas{
    width:100% !important;
    height:100% !important;
    display:block;
    background:transparent;
  }

  .last-update{
    font-size:20px;
    margin-top:10px;
    text-align:left;
    color:#e2e2e2;
  }

  .right-panel-title{
    font-size:28px;
    font-weight:900;
    margin-bottom:8px;
    text-shadow: 0 2px 8px rgba(0,0,0,0.55);
  }

  .small-note{
    font-size:14px;
    opacity:0.85;
    margin-top:8px;
  }

  /* адаптив */
  @media (max-width:1100px){
    .content-row{ flex-direction:column; }
    .panel-wide,.right-column{ flex:1; width:100%; }
    .chart-wrap-alma{ height:380px; }
  }
  @media (max-width:768px){
    .chart-wrap-alma{ height:340px; }
    .header-title h1{ font-size:36px; }
    .header-title p{ font-size:18px; }
    .title{ font-size:28px; }
  }
  @media (max-width:480px){
    .chart-wrap-alma{ height:300px; }
  }
</style>
</head>

<body>
<div class="page-wrapper">
  <div class="overlay">

    <!-- ---------- ШАПКА ---------- -->
    <div class="header">
      <div class="logo-group">
        <img src="ii_logo.png" alt="Institute of Ionosphere logo">
        <div class="header-title">
          <h1>Space Weather Forecast</h1>
          <p>Институт ионосферы, Алматы, Казахстан<br>
             Лаборатория диагностики и прогноза космической погоды</p>
        </div>
        <img src="kaznu_logo.png" alt="KazNU logo">
      </div>
    </div>

    <div class="container">

      <!-- ---------- ОСНОВНОЙ РЯД ---------- -->
      <div class="content-row">

        <!-- ЛЕВЫЙ БОЛЬШОЙ БЛОК -->
        <div class="panel panel-wide">
          <div class="right-panel-title">Прогноз геомагнитной активности (Kp)</div>

          <div class="chart-area">
            <canvas id="kpChart"></canvas>
          </div>

          <div class="last-update" id="kp-last-update"></div>

          <button class="btn btn-admin" id="btn-admin">Admin</button>

          <div class="admin-panel" id="admin-panel">
            <h3>Редактирование прогноза</h3>

            <div class="form-grid" id="form-grid"></div>

            <label style="margin-top:12px; display:block; font-size:14px;">Текст статуса:</label>
            <input id="status-input" type="text" style="width:100%; margin-top:6px; padding:10px; border-radius:8px; border:1px solid rgba(255,255,255,0.2); background:#111; color:#fff;"/>

            <div class="form-actions">
              <button class="btn btn-save" id="btn-save">Save</button>
              <button class="btn btn-reset" id="btn-reset">Reset</button>
            </div>

            <div class="small-note">
              Изменения сохраняются в localStorage браузера. Для публикации на GitHub Pages заменяй этот файл вручную.
            </div>
          </div>
        </div>

        <!-- ПРАВАЯ КОЛОНКА -->
        <div class="right-column">
          <div class="panel">
            <h2>Оценка уровня геомагнитной активности</h2>
            <p>
              Прогноз Kp-индекса отражает ожидаемую степень возмущенности магнитосферы Земли.
              Значения Kp ≥ 5 соответствуют геомагнитной буре.
            </p>
          </div>

          <div class="panel">
            <h2>Интерпретация Kp</h2>
            <p>
              0–2: спокойная обстановка<br>
              3–4: слабые возмущения<br>
              5: магнитная буря (G1)<br>
              6: буря (G2)<br>
              7: сильная буря (G3)<br>
              8: очень сильная буря (G4)<br>
              9: экстремальная буря (G5)
            </p>
          </div>
        </div>

      </div><!-- /content-row -->

      <!-- ---------- НИЖНИЙ БЛОК (состояние + alma chart) ---------- -->
      <div class="bottom-block">
        <!-- состояние -->
        <div class="panel panel-bottom">
          <h2>Состояние околоземного космического пространства</h2>
          <p id="status-text">
            Обзор состояния космической погоды за период 17–23 ноября и прогноз на 24–30 ноября 2025 года. После экстремально - большой магнитной бури 12-13 ноября, наступило затишье. Количество активных областей почти не менялось: 3-4 АО. Количество
            солнечных вспышек уменьшилось: менее 10 в сутки. Значения потоков солнечного радиоизлучения на длине волны 10.7 см оставались в пределах 145–165 sfu. Корональные дыры и их влияние на Землю практически отсутствовали. В ближайшую неделю
            ожидается слабовозмущенная магнитосфера с периодическими повышениями Kp до 4, вероятность бурь уровня G1 невысока.
          </p>
        </div>

        <!-- alma chart -->
        <div class="panel" style="margin-top:20px;">
          <h2>Текущие 3-часовые K-индексы</h2>
          <div class="chart-wrap chart-wrap-alma">
            <canvas id="almaKChart"></canvas>
          </div>
          <div class="last-update" id="kaaa-last-update"></div>
        </div>
      </div>

    </div><!-- /container -->
  </div><!-- /overlay -->
</div><!-- /page-wrapper -->


<script>
/* ================== УТИЛИТЫ ================== */

function formatDateDDMMYY(dateObj){
  const dd = String(dateObj.getUTCDate()).padStart(2,"0");
  const mm = String(dateObj.getUTCMonth()+1).padStart(2,"0");
  const yy = String(dateObj.getUTCFullYear()).slice(-2);
  return `${dd}.${mm}.${yy}`;
}
function formatNowUtc(){
  const now = new Date();
  const dd = String(now.getUTCDate()).padStart(2,"0");
  const mm = String(now.getUTCMonth()+1).padStart(2,"0");
  const yy = String(now.getUTCFullYear());
  const hh = String(now.getUTCHours()).padStart(2,"0");
  const mi = String(now.getUTCMinutes()).padStart(2,"0");
  return `Последнее обновление: ${dd}.${mm}.${yy} ${hh}:${mi} UT`;
}

function generateForecastDates(){
  // 6 будущих точек через 3 часа от текущего UTC
  const arr = [];
  const now = new Date();
  now.setUTCMinutes(0,0,0);
  // ближайшая 3-часовая метка
  const h = now.getUTCHours();
  const rounded = Math.floor(h/3)*3;
  now.setUTCHours(rounded);

  for(let i=0;i<6;i++){
    const d = new Date(now.getTime() + i*3*3600*1000);
    const dd = String(d.getUTCDate()).padStart(2,"0");
    const mm = String(d.getUTCMonth()+1).padStart(2,"0");
    const yy = d.getUTCFullYear();
    const hh = String(d.getUTCHours()).padStart(2,"0");
    arr.push(`${dd}.${mm}.${yy} ${hh}:00`);
  }
  return arr;
}

function kpColor(v){
  if(v>=8) return "rgba(255,0,0,0.95)";
  if(v>=7) return "rgba(255,80,0,0.95)";
  if(v>=6) return "rgba(255,160,0,0.95)";
  if(v>=5) return "rgba(255,220,0,0.95)";
  if(v>=4) return "rgba(120,220,120,0.95)";
  if(v>=3) return "rgba(80,170,255,0.95)";
  return "rgba(170,170,170,0.95)";
}

function gfzKColor(v){
  if(v>=8) return "rgba(255,0,0,0.95)";
  if(v>=7) return "rgba(255,80,0,0.95)";
  if(v>=6) return "rgba(255,160,0,0.95)";
  if(v>=5) return "rgba(255,220,0,0.95)";
  if(v>=4) return "rgba(120,220,120,0.95)";
  if(v>=3) return "rgba(80,170,255,0.95)";
  return "rgba(170,170,170,0.95)";
}

/* ================= LOCAL STORAGE ================= */

const STORAGE_KEY = "kpForecastDataV1";

function loadData(){
  const defaultData = {
    dates: generateForecastDates(),
    kp: [1,2,4,6,7,8],
    lastUpdate: "",
    statusText: "Обзор состояния космической погоды за период 17–23 ноября и прогноз на 24–30 ноября 2025 года. После экстремально - большой магнитной бури 12-13 ноября, наступило затишье. Количество активных областей почти не менялось: 3-4 АО. Количество солнечных вспышек уменьшилось: менее 10 в сутки. Значения потоков солнечного радиоизлучения на длине волны 10.7 см оставались в пределах 145–165 sfu. Корональные дыры и их влияние на Землю практически отсутствовали. В ближайшую неделю ожидается слабовозмущенная магнитосфера с периодическими повышениями Kp до 4, вероятность бурь уровня G1 невысока."
  };

  try{
    const raw = localStorage.getItem(STORAGE_KEY);
    if(!raw) return defaultData;
    const parsed = JSON.parse(raw);
    if(!parsed.dates || !parsed.kp) return defaultData;
    return parsed;
  }catch{
    return defaultData;
  }
}
function saveData(data){ localStorage.setItem(STORAGE_KEY, JSON.stringify(data)); }

let kpChartInstance = null;

/* значения Kp внутри столбцов (верхний график) */
const valueLabelPlugin = {
  id:"valueLabel",
  afterDatasetsDraw(chart){
    if(!chart.canvas || chart.canvas.id !== "kpChart") return;

    const { ctx } = chart;
    const dataset = chart.data.datasets[0];
    const meta = chart.getDatasetMeta(0);

    ctx.save();
    ctx.font = "bold 24px Arial";
    ctx.fillStyle = "#ffffff";
    ctx.textAlign = "center";
    ctx.textBaseline = "middle";

    meta.data.forEach((bar, index) => {
      const val = dataset.data[index];
      if(val == null) return;

      const props = bar.getProps(["x","y","base"], true);
      const x = props.x;
      const y = props.y;
      const base = props.base;
      const centerY = y + (base - y)/2;

      ctx.fillText(val, x, centerY);
    });

    ctx.restore();
  }
};

/* разделители суток + дата над графиком (alma style используется на верхнем) */
const daySeparatorPlugin = {
  id:"daySeparator",
  afterDraw(chart){
    if(!chart.canvas || chart.canvas.id !== "kpChart") return;

    const { ctx, chartArea:{top,bottom}, scales:{x,y} } = chart;
    const labels = chart.data.labels || [];
    if(!labels.length) return;

    const parsed = labels.map(l=>{
      const [datePart] = l.split(" ");
      const [dd,mm,yyyy] = datePart.split(".");
      const d = new Date(Date.UTC(+yyyy, +mm-1, +dd));
      return d;
    });

    const groups = [];
    let currentDay = parsed[0].toISOString().slice(0,10);
    let startIdx = 0;
    for(let i=1;i<parsed.length;i++){
      const day = parsed[i].toISOString().slice(0,10);
      if(day !== currentDay){
        groups.push({day: currentDay, start: startIdx, end: i-1});
        currentDay = day;
        startIdx = i;
      }
    }
    groups.push({day: currentDay, start: startIdx, end: parsed.length-1});

    ctx.save();
    ctx.strokeStyle = "rgba(255,255,255,0.35)";
    ctx.lineWidth = 2;

    // вертикальные линии между сутками
    for(let g=1; g<groups.length; g++){
      const idx = groups[g].start;
      const xPos = x.getPixelForValue(idx);
      ctx.beginPath();
      ctx.moveTo(xPos, top);
      ctx.lineTo(xPos, bottom);
      ctx.stroke();
    }

    // подпись даты сверху
    ctx.fillStyle = "#ffffff";
    ctx.font = "bold 20px Arial";
    ctx.textAlign = "center";
    ctx.textBaseline = "bottom";

    groups.forEach(group=>{
      const midIndex = (group.start + group.end)/2;
      const xMid = x.getPixelForValue(midIndex);
      const dateText = formatDateDDMMYY(new Date(group.day+"T00:00:00Z"));
      const yPos = y.top - 14;
      ctx.fillText(dateText, xMid, yPos);
    });

    ctx.restore();
  }
};

/* значения K внутри столбцов (almaKChart) */
const almaValueLabelPlugin = {
  id:"almaValueLabel",
  afterDatasetsDraw(chart){
    if(!chart.canvas || chart.canvas.id !== "almaKChart") return;

    const { ctx } = chart;
    const dataset = chart.data.datasets[0];
    const meta = chart.getDatasetMeta(0);

    ctx.save();
    ctx.font = "bold 18px Arial";
    ctx.fillStyle = "#ffffff";
    ctx.textAlign = "center";
    ctx.textBaseline = "middle";

    meta.data.forEach((bar, index) => {
      const val = dataset.data[index];
      if(val == null) return;

      const props = bar.getProps(["x","y","base"], true);
      const x = props.x;
      const y = props.y;
      const base = props.base;
      const centerY = y + (base - y)/2;

      ctx.fillText(val, x, centerY);
    });

    ctx.restore();
  }
};

Chart.register(valueLabelPlugin, daySeparatorPlugin, almaValueLabelPlugin);

function renderKpChart(data){
  const ctx = document.getElementById("kpChart").getContext("2d");
  if(kpChartInstance) kpChartInstance.destroy();

  const colors = data.kp.map(kpColor);

  kpChartInstance = new Chart(ctx, {
    type:"bar",
    data:{
      labels: data.dates,
      datasets:[{
        data: data.kp,
        backgroundColor: colors,
        borderColor: "rgba(255,255,255,0.25)",
        borderWidth:1,
        barThickness:"flex",
        barPercentage:0.92,
        categoryPercentage:1.0,
        borderRadius:0
      }]
    },
    options:{
      devicePixelRatio: window.devicePixelRatio || 1,
      maintainAspectRatio:false,
      plugins:{
        legend:{ display:false }
      },
      layout:{ padding:{ top:56, right:24, left:12, bottom:16 } },
      scales:{
        y:{
          beginAtZero:true,
          max:9,
          ticks:{
            stepSize:1,
            color:"#ffffff",
            padding:10,
            font:{ family:"Arial", size:22, weight:"bold" }
          },
          grid:{ color:"rgba(255,255,255,0.18)" },
          title:{
            display:true,
            text:"Kp",
            color:"#ffffff",
            font:{ family:"Arial", size:26, weight:"bold" }
          }
        },
        x:{
          ticks:{
            color:"#ffffff",
            padding:10,
            font:{ family:"Arial", size:20, weight:"bold" },
            autoSkip:false,
            maxRotation:0,
            minRotation:0,
            callback:function(value){
              const raw = this.getLabelForValue(value);
              if(!raw) return "";
              const parts = raw.split(" ");
              const timePartFull = parts[1] || "";
              return timePartFull.slice(0,5);
            }
          },
          grid:{ display:false },
          title:{
            display:true,
            text:"UT (время)",
            color:"#ffffff",
            font:{ family:"Arial", size:26, weight:"bold" }
          }
        }
      }
    }
  });

  // last update
  const lastUpdateText = data.lastUpdate ? data.lastUpdate : formatNowUtc();
  document.getElementById("kp-last-update").textContent = lastUpdateText;
}

/* =================== ADMIN UI =================== */

function fillForm(data){
  const grid = document.getElementById("form-grid");
  grid.innerHTML = "";

  data.dates.forEach((d,i)=>{
    const wrap = document.createElement("div");
    const lab = document.createElement("label");
    lab.textContent = d;

    const inp = document.createElement("input");
    inp.type="number";
    inp.min="0";
    inp.max="9";
    inp.step="1";
    inp.value = data.kp[i];

    inp.dataset.index = i;

    wrap.appendChild(lab);
    wrap.appendChild(inp);
    grid.appendChild(wrap);
  });

  document.getElementById("status-input").value = data.statusText || "";
}

document.getElementById("btn-admin").onclick = ()=>{
  const panel = document.getElementById("admin-panel");
  panel.style.display = (panel.style.display === "none" || panel.style.display === "") ? "block" : "none";
};

document.getElementById("btn-save").onclick = ()=>{
  const inputs = document.querySelectorAll("#form-grid input");
  const data = loadData();

  inputs.forEach(inp=>{
    const idx = +inp.dataset.index;
    data.kp[idx] = +inp.value;
  });

  data.statusText = document.getElementById("status-input").value;
  data.lastUpdate = formatNowUtc();

  saveData(data);
  renderKpChart(data);
  document.getElementById("status-text").textContent = data.statusText;

  document.getElementById("admin-panel").style.display = "none";
  setTimeout(() => location.reload(), 100);
};

document.getElementById("btn-reset").onclick = () => {
  const data = { ...loadData(), dates: generateForecastDates(), lastUpdate: formatNowUtc() };
  data.kp = [1,2,4,6,7,8];
  data.statusText = "Обзор состояния космической погоды за период 17–23 ноября и прогноз на 24–30 ноября 2025 года. После экстремально - большой магнитной бури 12-13 ноября, наступило затишье. Количество активных областей почти не менялось: 3-4 АО. Количество солнечных вспышек уменьшилось: менее 10 в сутки. Значения потоков солнечного радиоизлучения на длине волны 10.7 см оставались в пределах 145–165 sfu. Корональные дыры и их влияние на Землю практически отсутствовали. В ближайшую неделю ожидается слабовозмущенная магнитосфера с периодическими повышениями Kp до 4, вероятность бурь уровня G1 невысока.";
  saveData(data);
  fillForm(data);
  renderKpChart(data);
  document.getElementById("status-text").textContent = data.statusText;
};

/* ================= 3-ЧАСОВЫЕ K-ИНДЕКСЫ АЛМА-АТА (KAAA) ================= */

let almaChartInstance = null;

function renderAlmaKChart(labels, values){
  const ctx = document.getElementById("almaKChart").getContext("2d");
  if(almaChartInstance) almaChartInstance.destroy();

  almaChartInstance = new Chart(ctx, {
    type:"bar",
    data:{
      labels,
      datasets:[{
        data: values,
        backgroundColor: values.map(gfzKColor),
        borderColor: function(context){
          const index = context.dataIndex;
          const labels = context.chart.data.labels;
          const baseColor = "rgba(255,255,255,0.22)";
          // разделитель суток чуть светлее
          if(index>0){
            const cur = labels[index].split(" ")[0];
            const prev = labels[index-1].split(" ")[0];
            if(cur !== prev) return "rgba(255,255,255,0.45)";
          }
          return baseColor;
        },
        borderWidth: function(context){
          const index = context.dataIndex;
          const labels = context.chart.data.labels;
          if(index>0){
            const cur = labels[index].split(" ")[0];
            const prev = labels[index-1].split(" ")[0];
            if(cur !== prev) return 2;
          }
          return 1;
        },
        barThickness:"flex",
        barPercentage:0.9,
        categoryPercentage:1.0,
        borderRadius:0
      }]
    },
    options:{
      devicePixelRatio: window.devicePixelRatio || 1,
      maintainAspectRatio:false,
      plugins:{ legend:{ display:false } },
      layout:{ padding:{ top:52, right:24, left:12, bottom:16 } },
      scales:{
        y:{
          beginAtZero:true,
          max:9,
          ticks:{
            stepSize:1,
            color:"#ffffff",
            padding:8,
            font:{ family:"Arial", size:20, weight:"bold" }
          },
          grid:{ color:"rgba(255,255,255,0.18)" },
          title:{
            display:true,
            text:"K (Алма-Ата, 3-час)",
            color:"#ffffff",
            font:{ family:"Arial", size:24, weight:"bold" }
          }
        },
        x:{
          ticks:{
            color:"#ffffff",
            padding:8,
            font:{ family:"Arial", size:20, weight:"bold" },
            autoSkip:false,
            maxRotation:0,
            minRotation:0,
            callback:function(value){
              const raw = this.getLabelForValue(value);
              if(!raw) return "";
              const parts = raw.split(" ");
              const timePartFull = parts[1] || "";
              return timePartFull.slice(0,5);
            }
          },
          grid:{ display:false },
          title:{
            display:true,
            text:"UT (часы)",
            color:"#ffffff",
            font:{ family:"Arial", size:24, weight:"bold" }
          }
        }
      }
    }
  });

  // Если kaaa_last_update не доступен — покажем хотя бы время последней точки
  if(labels.length){
    const lastRaw = labels[labels.length - 1];
    const txt = lastRaw ? `KAAA: последняя точка ${lastRaw} UT` : "";
    document.getElementById("kaaa-last-update").textContent = txt;
  }
}

/* ================= ИНИЦИАЛИЗАЦИЯ ================= */

(function init(){
  const data = loadData();
  if(!data.lastUpdate) data.lastUpdate = formatNowUtc();
  saveData(data);

  fillForm(data);
  renderKpChart(data);
  document.getElementById("status-text").textContent = data.statusText;

  // демо данные alma, если нет загрузки извне
  const almaLabels = [
    "24.11.2025 00:00","24.11.2025 03:00","24.11.2025 06:00","24.11.2025 09:00",
    "24.11.2025 12:00","24.11.2025 15:00","24.11.2025 18:00","24.11.2025 21:00",
    "25.11.2025 00:00","25.11.2025 03:00","25.11.2025 06:00","25.11.2025 09:00",
    "25.11.2025 12:00","25.11.2025 15:00","25.11.2025 18:00","25.11.2025 21:00"
  ];
  const almaValues = [2,2,3,4,4,3,3,2,2,3,3,4,4,3,2,2];

  renderAlmaKChart(almaLabels, almaValues);
})();
</script>

</body>
</html>
